<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2011 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>

<?php
preg_match("/index\.php\/(\w*)[\.\/]?/", $_SERVER['REQUEST_URI'], $matches);
if(!isset($matches[1]))
{
    $str = preg_replace("/index\.php/", "", $_SERVER['SCRIPT_NAME']);
    preg_match("/(\w*)[\.\/]?/", str_replace($str, "", $_SERVER['REQUEST_URI']), $matches);
}
?>

<?php
/**
 * Product list template
 *
 * @see Mage_Catalog_Block_Product_List
 */
?>
<!-- PRODUCT LISTING -->
		<div class="span-18 last" <?php if($matches[1] == "accessories") echo "style='width: 100%;'"?>>
                        <?php
                            $_helper = $this->helper('catalog/output');
                            $_category  = Mage::getModel('catalog/layer')->getCurrentCategory();
                            $_productCollection = $_category->getProductCollection();
                            $total = $_productCollection->count();

                            $limit = 6;
                            if(isset($_GET['page']))
                                $current_page = $_GET['page'];
                            else
                                $current_page = 1;

                            $_productCollection = $_category->getProductCollection()->setCurPage($current_page)->setPageSize($limit);

                            //echo $total;
                            
                        ?>
                        <?php if(!$_productCollection->count()){ ?>
                            <p class="note-msg"><?php echo $this->__('There are no products matching the selection.') ?></p>
                        <?php } else { $cnt = 0;?>
                            <?php foreach ($_productCollection as $_product)  {
                                //echo count($_product->getUpSellProductCollection());
                                $product = Mage::getModel('catalog/product')->load($_product->getId());
                                $prod_image = "";
                                foreach ($product->getMediaGalleryImages() as $image) {
                                    $prod_image = $image->getUrl();
                                    break;
                                }
                                if($prod_image == "")
                                    $prod_image = $product->getImageUrl();
                                ?>
                            <div class="span-6 last product_box">
                                <a href="<?php echo $_product->getProductUrl() ?>" style="display: table-cell; /*height: 335px;*/ height: auto; vertical-align: middle;">
                                    <img src="<?php echo $prod_image; ?>" style="width:220px; display: inline-block;"/>
                                </a>
				<div class="product_details">
					<h3><a href="<?php echo $_product->getProductUrl() ?>"><?php echo $product->getName();?>
                                                #<?php echo $product->getSKU();?>,
                                                Casual Dress Size <?php echo $product->getData('size');?> - New</a></h3>
					Retail: <span class="retail">$<?php echo ((int)$product->getPrice());?><sup>00</sup></span><br />

                                        <?php if((int)$product->getSpecialPrice() != 0) { ?>
					<div class="eb_cost">EB Price: $<?php echo ((int)$product->getSpecialPrice());?><sup>00</sup></div>
					Save: $<?php echo ((int)$product->getPrice() - (int)$product->getSpecialPrice());?><sup>00</sup><br />
                                        <?php } else { ?>
                                        <div class="eb_cost">EB Cost: $<?php echo ((int)$product->getPrice());?><sup>00</sup></div>
					Save: $0<sup>00</sup><br />
                                        <?php } ?>

					<a href="<?php echo $_product->getProductUrl() ?>" class="more">More Information</a>
				</div>
                            </div>
                            <?php if(($cnt+1)%3 == 0) { ?> <br clear="both" /> <?php } ?>
                            <?php $cnt++; } ?>
                        <?php if(($cnt+1)%3 != 0) { ?> <br clear="both" /> <?php }} ?>

                </div>
		<br clear="both" />
		<hr />

                <?php if($current_page > 1) { ?>
                <div class="left"><a href="<?php echo $_category->getUrl()."?page=".($current_page - 1);?>" class="less">PREVIOUS</a></div>
                <?php } else {?>
                <div class="left"><a href="<?php echo $_category->getUrl()."?page=".($current_page - 1);?>" class="less" style="visibility: hidden">PREVIOUS</a></div>
                <?php }?>

                <div class="center_pagination">
                <?php
                    if($current_page < 3)
                    {
                        for($i=1; $i<6; $i++)
                        {                            
                            ?>
                                <a href="<?php echo $_category->getUrl()."?page=".($i);?>" class="<?php echo ($i == $current_page) ? "current" : "";?>">
                                    <?php echo $i;?>
                                </a>
                            <?php

                            if($total < ($i * $limit))
                                break;
                        }
                    }
                    else if($current_page > (ceil($total/$limit) - 2))
                    {
                        for($i=floor($total/$limit)-4; $i<=ceil($total/$limit); $i++)
                        {
                            if($i <= 0)
                                $i=1;

                            ?>
                                <a href="<?php echo $_category->getUrl()."?page=".($i);?>" class="<?php echo ($i == $current_page) ? "current" : "";?>"><?php echo $i;?></a>
                            <?php
                        }
                    }
                    else
                    {
                        for($i=$current_page-2; $i<=$current_page+2;$i++)
                        {
                            if($i <= 0)
                                $i=1;
                            if($total < ($i * $limit))
                                break;
                            
                            ?>
                                <a href="<?php echo $_category->getUrl()."?page=".($i);?>" class="<?php echo ($i == $current_page) ? "current" : "";?>"><?php echo $i;?></a>
                            <?php
                        }
                    }
                ?>
                </div>

                <?php if($total > ($current_page * $limit)) { ?>
		<div class="right"><a href="<?php echo $_category->getUrl()."?page=".($current_page + 1);?>" class="more">MORE</a></div>
                <?php } ?>
		<br clear="both" />

		<hr />